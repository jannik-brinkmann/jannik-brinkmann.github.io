<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <title>Publications - Jannik Brinkmann</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>
<body>
    <div class="container publications">
        <h1>Publications</h1>
        <!-- <p class="text">
            For a complete list of publications, see
            <a class="link" href="https://scholar.google.com/citations?hl=en&user=YtdTeaMAAAAJ&view_op=list_works">Google Scholar</a> or 
            <a class="link" href="https://www.semanticscholar.org/author/Jannik-Brinkmann/2228224955">Semantic Scholar</a>.
        </p> -->

        <!-- Sort controls -->
        <div class="sort-controls">
            <button id="sort-by-date" class="button pill active">Sort by Date</button>
            <button id="sort-by-venue" class="button pill">Group by Venue Type</button>
        </div>
        
        <!-- Separate container for preprints -->
        <div id="preprints-container">
            <!-- Preprints will be loaded here -->
        </div>
        
        <!-- Separate container for conference publications -->
        <div id="publications-container">
            <!-- Conference publications will be loaded here -->
        </div>
    </div>

    <script type="module">
        import { loadPublications, sortByDate, HIGHLIGHT_AUTHOR } from './assets/js/publications.js';

        let currentSortMode = 'date';
        let data = null;
        const containers = {};

        function createItem(pub) {
            const li = document.createElement('li');
            li.className = 'publication-item';

            const authors = pub.authors.map(a => {
                const name = a.note ? `${a.name}<sup>${a.note}</sup>` : a.name;
                return a.name === HIGHLIGHT_AUTHOR ? `<span class="author-highlight">${name}</span>` : name;
            }).join(', ');

            const link = pub.links?.find(l => l.url?.includes('arxiv.org') || ['paper','arxiv'].includes(l.type?.toLowerCase())) || pub.links?.[0];
            const title = link?.url ? `<a href="${link.url}" class="publication-title-link">${pub.title}</a>` : `"${pub.title}"`;

            // Extract arXiv ID and format venue based on publication type
            const arxivId = link?.url?.match(/arxiv\.org\/abs\/(\d+\.\d+)/)?.[1];
            const isPreprint = pub.venue === "arXiv preprint";
            const venueHtml = isPreprint && arxivId
                ? `<em>arXiv preprint arXiv:${arxivId}</em>, ${pub.year}.`
                : `In <em>${pub.venue}</em>, ${pub.year}.`;

            li.innerHTML = `<div class="publication-content">
                <span class="publication-authors">${authors}.</span><span class="publication-title">${title}.</span><span class="publication-venue">${venueHtml}</span>
            </div>`;
            return li;
        }

        function renderSection(container, title, pubs) {
            if (!pubs?.length) return;
            const header = document.createElement('h3');
            header.textContent = title;
            header.className = 'publications-section-header';
            container.appendChild(header);

            const list = document.createElement('ul');
            list.className = 'publications-list publications-year-list';
            sortByDate(pubs).forEach(pub => list.appendChild(createItem(pub)));
            container.appendChild(list);
        }

        function renderByDate() {
            containers.preprints.innerHTML = '';
            containers.publications.innerHTML = '';
            containers.preprints.parentNode.insertBefore(containers.preprints, containers.publications);

            renderSection(containers.preprints, 'Preprints', data.preprints);

            const byYear = Object.groupBy(data.conference_publications || [], p => p.year);
            Object.keys(byYear).sort((a, b) => b - a).forEach(year => {
                renderSection(containers.publications, year, byYear[year]);
            });
        }

        function renderByVenue() {
            containers.preprints.innerHTML = '';
            containers.publications.innerHTML = '';
            containers.publications.parentNode.appendChild(containers.preprints);

            const byType = Object.groupBy(data.conference_publications || [], p => p.type || 'conference');
            renderSection(containers.publications, 'Journal Publications', byType.journal);
            renderSection(containers.publications, 'Conference Publications', byType.conference);
            renderSection(containers.publications, 'Workshop Publications', byType.workshop);
            renderSection(containers.preprints, 'Preprints', data.preprints);
        }

        function render() {
            currentSortMode === 'date' ? renderByDate() : renderByVenue();
            document.getElementById('sort-by-date').classList.toggle('active', currentSortMode === 'date');
            document.getElementById('sort-by-venue').classList.toggle('active', currentSortMode === 'venue');
        }

        containers.preprints = document.getElementById('preprints-container');
        containers.publications = document.getElementById('publications-container');

        try {
            data = await loadPublications();
            render();
        } catch (e) {
            containers.preprints.innerHTML = '<li>Error loading publications.</li>';
        }

        document.getElementById('sort-by-date').onclick = () => {
            if (currentSortMode !== 'date') { currentSortMode = 'date'; render(); }
        };
        document.getElementById('sort-by-venue').onclick = () => {
            if (currentSortMode !== 'venue') { currentSortMode = 'venue'; render(); }
        };
    </script>
</body>
</html>
